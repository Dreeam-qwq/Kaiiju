From 0000000000000000000000000000000000000000 Mon Sep 17 00:00:00 2001
From: "Sofiane H. Djerbi" <46628754+kugge@users.noreply.github.com>
Date: Fri, 31 Mar 2023 01:21:52 +0300
Subject: [PATCH] Purpur Exploit Toggleable Sand Duping


diff --git a/src/main/java/dev/kaiijumc/kaiiju/KaiijuWorldConfig.java b/src/main/java/dev/kaiijumc/kaiiju/KaiijuWorldConfig.java
index 0555d436e38c388578e563a9120ebfe5334ae2c2..410bb2832140648ab0b59a35545a27f7d78c7222 100644
--- a/src/main/java/dev/kaiijumc/kaiiju/KaiijuWorldConfig.java
+++ b/src/main/java/dev/kaiijumc/kaiiju/KaiijuWorldConfig.java
@@ -123,6 +123,9 @@ public class KaiijuWorldConfig {
         return value.isEmpty() ? fallback : value;
     }
 
+    public boolean fixSandDuping = true;
+
     private void exploitSettings() {
+        fixSandDuping = getBoolean("exploit.fix-sand-duping", fixSandDuping);
     }
 }
\ No newline at end of file
diff --git a/src/main/java/net/minecraft/world/entity/item/FallingBlockEntity.java b/src/main/java/net/minecraft/world/entity/item/FallingBlockEntity.java
index c8d125955754e27da54d95fb5b1cea39ca54b618..f0a15acb604bb636bd49c0ce931053541986797d 100644
--- a/src/main/java/net/minecraft/world/entity/item/FallingBlockEntity.java
+++ b/src/main/java/net/minecraft/world/entity/item/FallingBlockEntity.java
@@ -131,7 +131,7 @@ public class FallingBlockEntity extends Entity {
     @Override
     public void tick() {
         // Paper start - fix sand duping
-        if (this.isRemoved()) {
+        if (this.level.kaiijuConfig.fixSandDuping && this.isRemoved()) { // Kaiiju
             return;
         }
         // Paper end - fix sand duping
@@ -148,7 +148,7 @@ public class FallingBlockEntity extends Entity {
             this.move(MoverType.SELF, this.getDeltaMovement());
 
             // Paper start - fix sand duping
-            if (this.isRemoved()) {
+            if (this.level.kaiijuConfig.fixSandDuping && this.isRemoved()) { // Kaiiju
                 return;
             }
             // Paper end - fix sand duping
