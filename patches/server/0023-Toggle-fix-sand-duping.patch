From 0000000000000000000000000000000000000000 Mon Sep 17 00:00:00 2001
From: "Sofiane H. Djerbi" <46628754+kugge@users.noreply.github.com>
Date: Thu, 18 May 2023 20:10:29 +0300
Subject: [PATCH] Toggle fix sand duping


diff --git a/src/main/java/dev/kaiijumc/kaiiju/KaiijuWorldConfig.java b/src/main/java/dev/kaiijumc/kaiiju/KaiijuWorldConfig.java
index f24874a195fcba35f37a03a85c84f161abb790e8..d879e6de9e1b661d0e43255ee78627e890012c1a 100644
--- a/src/main/java/dev/kaiijumc/kaiiju/KaiijuWorldConfig.java
+++ b/src/main/java/dev/kaiijumc/kaiiju/KaiijuWorldConfig.java
@@ -153,6 +153,7 @@ public class KaiijuWorldConfig {
     public boolean breakRedstoneOnTopOfTrapDoorsEarly = true;
     public boolean fixTripWireStateInconsistency = true;
     public boolean teleportRemovedEntities = false;
+    public boolean fixFallingBlockDuping = true;
 
     private void gameplaySettings() {
         shulkerBoxDropContentsWhenDestroyed = getBoolean("gameplay.shulker-box-drop-contents-when-destroyed", shulkerBoxDropContentsWhenDestroyed);
@@ -162,5 +163,6 @@ public class KaiijuWorldConfig {
         breakRedstoneOnTopOfTrapDoorsEarly = getBoolean("gameplay.break-redstone-on-top-of-trap-doors-early", breakRedstoneOnTopOfTrapDoorsEarly);
         fixTripWireStateInconsistency = getBoolean("gameplay.fix-tripwire-state-inconsistency", fixTripWireStateInconsistency);
         teleportRemovedEntities = getBoolean("gameplay.teleport-removed-entities", teleportRemovedEntities);
+        fixFallingBlockDuping = getBoolean("gameplay.fix-falling-block-duping", fixFallingBlockDuping);
     }
 }
\ No newline at end of file
diff --git a/src/main/java/net/minecraft/world/entity/item/FallingBlockEntity.java b/src/main/java/net/minecraft/world/entity/item/FallingBlockEntity.java
index c8d125955754e27da54d95fb5b1cea39ca54b618..8fb7d097792911bb6c6de32412be4cb16a42a8cf 100644
--- a/src/main/java/net/minecraft/world/entity/item/FallingBlockEntity.java
+++ b/src/main/java/net/minecraft/world/entity/item/FallingBlockEntity.java
@@ -131,7 +131,7 @@ public class FallingBlockEntity extends Entity {
     @Override
     public void tick() {
         // Paper start - fix sand duping
-        if (this.isRemoved()) {
+        if (this.level.kaiijuConfig.fixFallingBlockDuping && this.isRemoved()) { // Kaiiju - Configurable falling block duping
             return;
         }
         // Paper end - fix sand duping
@@ -148,7 +148,7 @@ public class FallingBlockEntity extends Entity {
             this.move(MoverType.SELF, this.getDeltaMovement());
 
             // Paper start - fix sand duping
-            if (this.isRemoved()) {
+            if (this.level.kaiijuConfig.fixFallingBlockDuping && this.isRemoved()) { // Kaiiju - Configurable falling block duping
                 return;
             }
             // Paper end - fix sand duping
